{"sha":"0158f1d506c145444cd5004a9ac9d6aec7da9b98","node_id":"MDY6Q29tbWl0NTI5ODc5MDowMTU4ZjFkNTA2YzE0NTQ0NGNkNTAwNGE5YWM5ZDZhZWM3ZGE5Yjk4","commit":{"author":{"name":"Sander Smeets","email":"sander@droneslab.com","date":"2017-04-02T23:39:39Z"},"committer":{"name":"Daniel Agar","email":"daniel@agar.ca","date":"2017-04-02T23:39:39Z"},"message":"VTOL Standard transition improvements (#6904)\n\n\r\n * FW actuators fully on the entirety of front and back transition\r\n * back transition ramp up to full MC weight half way through back transition\r\n * increase maximum front and back transition times\r\n *  navigator don't reset transition altitude","tree":{"sha":"55b0ca451ce85ae7786e39dc992111c2061b043c","url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/trees/55b0ca451ce85ae7786e39dc992111c2061b043c"},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/commits/0158f1d506c145444cd5004a9ac9d6aec7da9b98","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/0158f1d506c145444cd5004a9ac9d6aec7da9b98","html_url":"https://github.com/PX4/PX4-Autopilot/commit/0158f1d506c145444cd5004a9ac9d6aec7da9b98","comments_url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/0158f1d506c145444cd5004a9ac9d6aec7da9b98/comments","author":{"login":"sanderux","id":14801663,"node_id":"MDQ6VXNlcjE0ODAxNjYz","avatar_url":"https://avatars.githubusercontent.com/u/14801663?v=4","gravatar_id":"","url":"https://api.github.com/users/sanderux","html_url":"https://github.com/sanderux","followers_url":"https://api.github.com/users/sanderux/followers","following_url":"https://api.github.com/users/sanderux/following{/other_user}","gists_url":"https://api.github.com/users/sanderux/gists{/gist_id}","starred_url":"https://api.github.com/users/sanderux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sanderux/subscriptions","organizations_url":"https://api.github.com/users/sanderux/orgs","repos_url":"https://api.github.com/users/sanderux/repos","events_url":"https://api.github.com/users/sanderux/events{/privacy}","received_events_url":"https://api.github.com/users/sanderux/received_events","type":"User","site_admin":false},"committer":{"login":"dagar","id":84712,"node_id":"MDQ6VXNlcjg0NzEy","avatar_url":"https://avatars.githubusercontent.com/u/84712?v=4","gravatar_id":"","url":"https://api.github.com/users/dagar","html_url":"https://github.com/dagar","followers_url":"https://api.github.com/users/dagar/followers","following_url":"https://api.github.com/users/dagar/following{/other_user}","gists_url":"https://api.github.com/users/dagar/gists{/gist_id}","starred_url":"https://api.github.com/users/dagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dagar/subscriptions","organizations_url":"https://api.github.com/users/dagar/orgs","repos_url":"https://api.github.com/users/dagar/repos","events_url":"https://api.github.com/users/dagar/events{/privacy}","received_events_url":"https://api.github.com/users/dagar/received_events","type":"User","site_admin":false},"parents":[{"sha":"1d681b0356f2d71d0b152e6e95a922463f2137fd","url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/1d681b0356f2d71d0b152e6e95a922463f2137fd","html_url":"https://github.com/PX4/PX4-Autopilot/commit/1d681b0356f2d71d0b152e6e95a922463f2137fd"}],"stats":{"total":49,"additions":30,"deletions":19},"files":[{"sha":"6dd61c8b01f855c72ef47b4ddf0cdaf535f07bfe","filename":"src/modules/navigator/mission.cpp","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/PX4/PX4-Autopilot/blob/0158f1d506c145444cd5004a9ac9d6aec7da9b98/src%2Fmodules%2Fnavigator%2Fmission.cpp","raw_url":"https://github.com/PX4/PX4-Autopilot/raw/0158f1d506c145444cd5004a9ac9d6aec7da9b98/src%2Fmodules%2Fnavigator%2Fmission.cpp","contents_url":"https://api.github.com/repos/PX4/PX4-Autopilot/contents/src%2Fmodules%2Fnavigator%2Fmission.cpp?ref=0158f1d506c145444cd5004a9ac9d6aec7da9b98","patch":"@@ -1497,7 +1497,6 @@ Mission::generate_waypoint_from_heading(struct position_setpoint_s *setpoint, fl\n \t\t1000000.0f,\n \t\t&(setpoint->lat),\n \t\t&(setpoint->lon));\n-\tsetpoint->alt = _navigator->get_global_position()->alt;\n \tsetpoint->type = position_setpoint_s::SETPOINT_TYPE_POSITION;\n \tsetpoint->yaw = yaw;\n }"},{"sha":"50995b08a335657f6faee411b1fd43fbda9bda51","filename":"src/modules/vtol_att_control/standard.cpp","status":"modified","additions":26,"deletions":14,"changes":40,"blob_url":"https://github.com/PX4/PX4-Autopilot/blob/0158f1d506c145444cd5004a9ac9d6aec7da9b98/src%2Fmodules%2Fvtol_att_control%2Fstandard.cpp","raw_url":"https://github.com/PX4/PX4-Autopilot/raw/0158f1d506c145444cd5004a9ac9d6aec7da9b98/src%2Fmodules%2Fvtol_att_control%2Fstandard.cpp","contents_url":"https://api.github.com/repos/PX4/PX4-Autopilot/contents/src%2Fmodules%2Fvtol_att_control%2Fstandard.cpp?ref=0158f1d506c145444cd5004a9ac9d6aec7da9b98","patch":"@@ -86,11 +86,11 @@ Standard::parameters_update()\n \n \t/* duration of a forwards transition to fw mode */\n \tparam_get(_params_handles_standard.front_trans_dur, &v);\n-\t_params_standard.front_trans_dur = math::constrain(v, 0.0f, 5.0f);\n+\t_params_standard.front_trans_dur = math::constrain(v, 0.0f, 20.0f);\n \n \t/* duration of a back transition to mc mode */\n \tparam_get(_params_handles_standard.back_trans_dur, &v);\n-\t_params_standard.back_trans_dur = math::constrain(v, 0.0f, 5.0f);\n+\t_params_standard.back_trans_dur = math::constrain(v, 0.0f, 20.0f);\n \n \t/* target throttle value for pusher motor during the transition to fw mode */\n \tparam_get(_params_handles_standard.pusher_trans, &v);\n@@ -315,9 +315,10 @@ void Standard::update_transition_state()\n \t\t_v_att_sp->q_d_valid = true;\n \n \t\t// continually increase mc attitude control as we transition back to mc mode\n-\t\tif (_params_standard.back_trans_dur > 0.0f) {\n-\t\t\tfloat weight = (float)hrt_elapsed_time(&_vtol_schedule.transition_start) / (_params_standard.back_trans_dur *\n-\t\t\t\t\t1000000.0f);\n+\t\tif (_params_standard.back_trans_dur > FLT_EPSILON) {\n+\t\t\tfloat weight = (float)hrt_elapsed_time(&_vtol_schedule.transition_start) /\n+\t\t\t\t       ((_params_standard.back_trans_dur / 2) * 1000000.0f);\n+\t\t\tweight = math::constrain(weight, 0.0f, 1.0f);\n \t\t\t_mc_roll_weight = weight;\n \t\t\t_mc_pitch_weight = weight;\n \t\t\t_mc_yaw_weight = weight;\n@@ -451,15 +452,26 @@ void Standard::fill_actuator_outputs()\n \t// fixed wing controls\n \t_actuators_out_1->timestamp = _actuators_fw_in->timestamp;\n \n-\t//roll\n-\t_actuators_out_1->control[actuator_controls_s::INDEX_ROLL] =\n-\t\t-_actuators_fw_in->control[actuator_controls_s::INDEX_ROLL] * (1 - _mc_roll_weight);\n-\t//pitch\n-\t_actuators_out_1->control[actuator_controls_s::INDEX_PITCH] =\n-\t\t(_actuators_fw_in->control[actuator_controls_s::INDEX_PITCH] + _params->fw_pitch_trim) * (1 - _mc_pitch_weight);\n-\t// yaw\n-\t_actuators_out_1->control[actuator_controls_s::INDEX_YAW] =\n-\t\t_actuators_fw_in->control[actuator_controls_s::INDEX_YAW] * (1 - _mc_yaw_weight);\n+\n+\tif (_vtol_schedule.flight_mode != MC_MODE) {\n+\n+\t\t//roll\n+\t\t_actuators_out_1->control[actuator_controls_s::INDEX_ROLL] =\n+\t\t\t-_actuators_fw_in->control[actuator_controls_s::INDEX_ROLL];\n+\t\t//pitch\n+\t\t_actuators_out_1->control[actuator_controls_s::INDEX_PITCH] =\n+\t\t\t_actuators_fw_in->control[actuator_controls_s::INDEX_PITCH] + _params->fw_pitch_trim;\n+\t\t// yaw\n+\t\t_actuators_out_1->control[actuator_controls_s::INDEX_YAW] =\n+\t\t\t_actuators_fw_in->control[actuator_controls_s::INDEX_YAW];\n+\n+\t} else {\n+\n+\t\t// zero outputs when inactive\n+\t\t_actuators_out_1->control[actuator_controls_s::INDEX_ROLL] = 0.0f;\n+\t\t_actuators_out_1->control[actuator_controls_s::INDEX_PITCH] = _params->fw_pitch_trim;\n+\t\t_actuators_out_1->control[actuator_controls_s::INDEX_YAW] = 0.0f;\n+\t}\n \n \t// set the fixed wing throttle control\n \tif (_vtol_schedule.flight_mode == FW_MODE && _armed->armed) {"},{"sha":"c9e6cffd4907c477a093c874aa43aa070948295f","filename":"src/modules/vtol_att_control/vtol_att_control_params.c","status":"modified","additions":4,"deletions":4,"changes":8,"blob_url":"https://github.com/PX4/PX4-Autopilot/blob/0158f1d506c145444cd5004a9ac9d6aec7da9b98/src%2Fmodules%2Fvtol_att_control%2Fvtol_att_control_params.c","raw_url":"https://github.com/PX4/PX4-Autopilot/raw/0158f1d506c145444cd5004a9ac9d6aec7da9b98/src%2Fmodules%2Fvtol_att_control%2Fvtol_att_control_params.c","contents_url":"https://api.github.com/repos/PX4/PX4-Autopilot/contents/src%2Fmodules%2Fvtol_att_control%2Fvtol_att_control_params.c?ref=0158f1d506c145444cd5004a9ac9d6aec7da9b98","patch":"@@ -199,12 +199,12 @@ PARAM_DEFINE_INT32(VT_ELEV_MC_LOCK, 0);\n  *\n  * @unit s\n  * @min 0.00\n- * @max 10.00\n+ * @max 20.00\n  * @increment 1\n  * @decimal 2\n  * @group VTOL Attitude Control\n  */\n-PARAM_DEFINE_FLOAT(VT_F_TRANS_DUR, 3.0f);\n+PARAM_DEFINE_FLOAT(VT_F_TRANS_DUR, 5.0f);\n \n /**\n  * Duration of a back transition\n@@ -213,12 +213,12 @@ PARAM_DEFINE_FLOAT(VT_F_TRANS_DUR, 3.0f);\n  *\n  * @unit s\n  * @min 0.00\n- * @max 10.00\n+ * @max 20.00\n  * @increment 1\n  * @decimal 2\n  * @group VTOL Attitude Control\n  */\n-PARAM_DEFINE_FLOAT(VT_B_TRANS_DUR, 2.0f);\n+PARAM_DEFINE_FLOAT(VT_B_TRANS_DUR, 4.0f);\n \n /**\n  * Transition blending airspeed"}]}