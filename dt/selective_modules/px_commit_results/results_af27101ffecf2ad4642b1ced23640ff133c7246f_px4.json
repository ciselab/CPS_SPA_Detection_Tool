{"sha":"af27101ffecf2ad4642b1ced23640ff133c7246f","node_id":"MDY6Q29tbWl0NTI5ODc5MDphZjI3MTAxZmZlY2YyYWQ0NjQyYjFjZWQyMzY0MGZmMTMzYzcyNDZm","commit":{"author":{"name":"Andrew Tridgell","email":"tridge@samba.org","date":"2013-05-02T11:27:20Z"},"committer":{"name":"Andrew Tridgell","email":"tridge@samba.org","date":"2013-05-04T09:18:51Z"},"message":"px4io: changed adc_measure() to return 0xffff on error, and lower timeout\n\nthe timeout of 1ms was far too long, and could impact flight\nperformance\n\nReturning 0xffff on error matches the FMU code, and allows bad values\nto be discarded","tree":{"sha":"37a730ac165d412aa6cd2b246affbf1b4dfde3bc","url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/trees/37a730ac165d412aa6cd2b246affbf1b4dfde3bc"},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/commits/af27101ffecf2ad4642b1ced23640ff133c7246f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/af27101ffecf2ad4642b1ced23640ff133c7246f","html_url":"https://github.com/PX4/PX4-Autopilot/commit/af27101ffecf2ad4642b1ced23640ff133c7246f","comments_url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/af27101ffecf2ad4642b1ced23640ff133c7246f/comments","author":{"login":"tridge","id":831867,"node_id":"MDQ6VXNlcjgzMTg2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/831867?v=4","gravatar_id":"","url":"https://api.github.com/users/tridge","html_url":"https://github.com/tridge","followers_url":"https://api.github.com/users/tridge/followers","following_url":"https://api.github.com/users/tridge/following{/other_user}","gists_url":"https://api.github.com/users/tridge/gists{/gist_id}","starred_url":"https://api.github.com/users/tridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tridge/subscriptions","organizations_url":"https://api.github.com/users/tridge/orgs","repos_url":"https://api.github.com/users/tridge/repos","events_url":"https://api.github.com/users/tridge/events{/privacy}","received_events_url":"https://api.github.com/users/tridge/received_events","type":"User","site_admin":false},"committer":{"login":"tridge","id":831867,"node_id":"MDQ6VXNlcjgzMTg2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/831867?v=4","gravatar_id":"","url":"https://api.github.com/users/tridge","html_url":"https://github.com/tridge","followers_url":"https://api.github.com/users/tridge/followers","following_url":"https://api.github.com/users/tridge/following{/other_user}","gists_url":"https://api.github.com/users/tridge/gists{/gist_id}","starred_url":"https://api.github.com/users/tridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tridge/subscriptions","organizations_url":"https://api.github.com/users/tridge/orgs","repos_url":"https://api.github.com/users/tridge/repos","events_url":"https://api.github.com/users/tridge/events{/privacy}","received_events_url":"https://api.github.com/users/tridge/received_events","type":"User","site_admin":false},"parents":[{"sha":"44015d69154062d42ecc3aa0c9b25d7019bd5a71","url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/44015d69154062d42ecc3aa0c9b25d7019bd5a71","html_url":"https://github.com/PX4/PX4-Autopilot/commit/44015d69154062d42ecc3aa0c9b25d7019bd5a71"}],"stats":{"total":10,"additions":7,"deletions":3},"files":[{"sha":"f744698be261fcdd4b31b28681fc4d0bb2e67cc6","filename":"src/modules/px4iofirmware/adc.c","status":"modified","additions":7,"deletions":3,"changes":10,"blob_url":"https://github.com/PX4/PX4-Autopilot/blob/af27101ffecf2ad4642b1ced23640ff133c7246f/src%2Fmodules%2Fpx4iofirmware%2Fadc.c","raw_url":"https://github.com/PX4/PX4-Autopilot/raw/af27101ffecf2ad4642b1ced23640ff133c7246f/src%2Fmodules%2Fpx4iofirmware%2Fadc.c","contents_url":"https://api.github.com/repos/PX4/PX4-Autopilot/contents/src%2Fmodules%2Fpx4iofirmware%2Fadc.c?ref=af27101ffecf2ad4642b1ced23640ff133c7246f","patch":"@@ -135,6 +135,9 @@ adc_init(void)\n \treturn 0;\n }\n \n+/*\n+  return one measurement, or 0xffff on error\n+ */\n uint16_t\n adc_measure(unsigned channel)\n {\n@@ -154,9 +157,10 @@ adc_measure(unsigned channel)\n \twhile (!(rSR & ADC_SR_EOC)) {\n \n \t\t/* never spin forever - this will give a bogus result though */\n-\t\tif (hrt_elapsed_time(&now) > 1000) {\n+\t\tif (hrt_elapsed_time(&now) > 100) {\n \t\t\tdebug(\"adc timeout\");\n-\t\t\tbreak;\n+\t\t\tperf_end(adc_perf);\n+\t\t\treturn 0xffff;\n \t\t}\n \t}\n \n@@ -165,4 +169,4 @@ adc_measure(unsigned channel)\n \n \tperf_end(adc_perf);\n \treturn result;\n-}\n\\ No newline at end of file\n+}"}]}