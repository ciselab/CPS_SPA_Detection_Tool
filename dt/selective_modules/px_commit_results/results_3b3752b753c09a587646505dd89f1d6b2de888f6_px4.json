{"sha":"3b3752b753c09a587646505dd89f1d6b2de888f6","node_id":"MDY6Q29tbWl0NTI5ODc5MDozYjM3NTJiNzUzYzA5YTU4NzY0NjUwNWRkODlmMWQ2YjJkZTg4OGY2","commit":{"author":{"name":"AnnaDaiZH","email":"32288802+AnnaDaiZH@users.noreply.github.com","date":"2019-01-08T19:25:39Z"},"committer":{"name":"Daniel Agar","email":"daniel@agar.ca","date":"2019-01-08T19:25:39Z"},"message":"pmw3901 increase publish rate and max_ground_distance (#11066)\n\n* increase pmw3901 publish rate and max_ground_distance\r\n* set work queue to high priority","tree":{"sha":"dbf338e750503f293f620b88306015f9f264842c","url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/trees/dbf338e750503f293f620b88306015f9f264842c"},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/commits/3b3752b753c09a587646505dd89f1d6b2de888f6","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/3b3752b753c09a587646505dd89f1d6b2de888f6","html_url":"https://github.com/PX4/PX4-Autopilot/commit/3b3752b753c09a587646505dd89f1d6b2de888f6","comments_url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/3b3752b753c09a587646505dd89f1d6b2de888f6/comments","author":{"login":"AnnaDaiZH","id":32288802,"node_id":"MDQ6VXNlcjMyMjg4ODAy","avatar_url":"https://avatars.githubusercontent.com/u/32288802?v=4","gravatar_id":"","url":"https://api.github.com/users/AnnaDaiZH","html_url":"https://github.com/AnnaDaiZH","followers_url":"https://api.github.com/users/AnnaDaiZH/followers","following_url":"https://api.github.com/users/AnnaDaiZH/following{/other_user}","gists_url":"https://api.github.com/users/AnnaDaiZH/gists{/gist_id}","starred_url":"https://api.github.com/users/AnnaDaiZH/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnnaDaiZH/subscriptions","organizations_url":"https://api.github.com/users/AnnaDaiZH/orgs","repos_url":"https://api.github.com/users/AnnaDaiZH/repos","events_url":"https://api.github.com/users/AnnaDaiZH/events{/privacy}","received_events_url":"https://api.github.com/users/AnnaDaiZH/received_events","type":"User","site_admin":false},"committer":{"login":"dagar","id":84712,"node_id":"MDQ6VXNlcjg0NzEy","avatar_url":"https://avatars.githubusercontent.com/u/84712?v=4","gravatar_id":"","url":"https://api.github.com/users/dagar","html_url":"https://github.com/dagar","followers_url":"https://api.github.com/users/dagar/followers","following_url":"https://api.github.com/users/dagar/following{/other_user}","gists_url":"https://api.github.com/users/dagar/gists{/gist_id}","starred_url":"https://api.github.com/users/dagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dagar/subscriptions","organizations_url":"https://api.github.com/users/dagar/orgs","repos_url":"https://api.github.com/users/dagar/repos","events_url":"https://api.github.com/users/dagar/events{/privacy}","received_events_url":"https://api.github.com/users/dagar/received_events","type":"User","site_admin":false},"parents":[{"sha":"5e53f73ad87f8fb0322edcdce54ec5aca6db981c","url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/5e53f73ad87f8fb0322edcdce54ec5aca6db981c","html_url":"https://github.com/PX4/PX4-Autopilot/commit/5e53f73ad87f8fb0322edcdce54ec5aca6db981c"}],"stats":{"total":11,"additions":7,"deletions":4},"files":[{"sha":"5b68b57ec06d18fc005862c94a12e228481a4f14","filename":"src/drivers/pmw3901/pmw3901.cpp","status":"modified","additions":7,"deletions":4,"changes":11,"blob_url":"https://github.com/PX4/PX4-Autopilot/blob/3b3752b753c09a587646505dd89f1d6b2de888f6/src%2Fdrivers%2Fpmw3901%2Fpmw3901.cpp","raw_url":"https://github.com/PX4/PX4-Autopilot/raw/3b3752b753c09a587646505dd89f1d6b2de888f6/src%2Fdrivers%2Fpmw3901%2Fpmw3901.cpp","contents_url":"https://api.github.com/repos/PX4/PX4-Autopilot/contents/src%2Fdrivers%2Fpmw3901%2Fpmw3901.cpp?ref=3b3752b753c09a587646505dd89f1d6b2de888f6","patch":"@@ -140,6 +140,8 @@ class PMW3901 : public device::SPI\n \tint _class_instance;\n \tint _orb_class_instance;\n \n+\tconst uint64_t _collect_time = 15000; // usecs, optical flow data publish rate\n+\n \torb_advert_t _optical_flow_pub;\n \torb_advert_t _subsystem_pub;\n \n@@ -575,7 +577,8 @@ PMW3901::collect()\n \t_flow_sum_x += delta_x_raw;\n \t_flow_sum_y += delta_y_raw;\n \n-\tif (_flow_dt_sum_usec < 45000) {\n+\t// returns if the collect time has not been reached\n+\tif (_flow_dt_sum_usec < _collect_time) {\n \n \t\treturn ret;\n \t}\n@@ -617,7 +620,7 @@ PMW3901::collect()\n \t// set (conservative) specs according to datasheet\n \treport.max_flow_rate = 5.0f;       // Datasheet: 7.4 rad/s\n \treport.min_ground_distance = 0.1f; // Datasheet: 80mm\n-\treport.max_ground_distance = 5.0f; // Datasheet: infinity\n+\treport.max_ground_distance = 30.0f; // Datasheet: infinity\n \n \t_flow_dt_sum_usec = 0;\n \t_flow_sum_x = 0;\n@@ -679,7 +682,7 @@ PMW3901::start()\n \t_reports->flush();\n \n \t/* schedule a cycle to start things */\n-\twork_queue(LPWORK, &_work, (worker_t)&PMW3901::cycle_trampoline, this, USEC2TICK(PMW3901_US));\n+\twork_queue(HPWORK, &_work, (worker_t)&PMW3901::cycle_trampoline, this, USEC2TICK(PMW3901_US));\n \n \t/* notify about state change */\n \tstruct subsystem_info_s info = {};\n@@ -718,7 +721,7 @@ PMW3901::cycle()\n \tcollect();\n \n \t/* schedule a fresh cycle call when the measurement is done */\n-\twork_queue(LPWORK,\n+\twork_queue(HPWORK,\n \t\t   &_work,\n \t\t   (worker_t)&PMW3901::cycle_trampoline,\n \t\t   this,"}]}