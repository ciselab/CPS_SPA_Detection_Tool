{"sha":"0e949a36ee104b8ace10eedaa1fcd83a00e3265a","node_id":"MDY6Q29tbWl0NTI5ODc5MDowZTk0OWEzNmVlMTA0YjhhY2UxMGVlZGFhMWZjZDgzYTAwZTMyNjVh","commit":{"author":{"name":"Daniel Agar","email":"daniel@agar.ca","date":"2019-05-30T01:58:18Z"},"committer":{"name":"Daniel Agar","email":"daniel@agar.ca","date":"2019-07-30T14:47:10Z"},"message":"task_stack_info increase task_name length to match NuttX CONFIG_TASK_NAME_SIZE","tree":{"sha":"4cdc129563c9ad631f0e225cfbdd4e6bc87faa8a","url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/trees/4cdc129563c9ad631f0e225cfbdd4e6bc87faa8a"},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/commits/0e949a36ee104b8ace10eedaa1fcd83a00e3265a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/0e949a36ee104b8ace10eedaa1fcd83a00e3265a","html_url":"https://github.com/PX4/PX4-Autopilot/commit/0e949a36ee104b8ace10eedaa1fcd83a00e3265a","comments_url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/0e949a36ee104b8ace10eedaa1fcd83a00e3265a/comments","author":{"login":"dagar","id":84712,"node_id":"MDQ6VXNlcjg0NzEy","avatar_url":"https://avatars.githubusercontent.com/u/84712?v=4","gravatar_id":"","url":"https://api.github.com/users/dagar","html_url":"https://github.com/dagar","followers_url":"https://api.github.com/users/dagar/followers","following_url":"https://api.github.com/users/dagar/following{/other_user}","gists_url":"https://api.github.com/users/dagar/gists{/gist_id}","starred_url":"https://api.github.com/users/dagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dagar/subscriptions","organizations_url":"https://api.github.com/users/dagar/orgs","repos_url":"https://api.github.com/users/dagar/repos","events_url":"https://api.github.com/users/dagar/events{/privacy}","received_events_url":"https://api.github.com/users/dagar/received_events","type":"User","site_admin":false},"committer":{"login":"dagar","id":84712,"node_id":"MDQ6VXNlcjg0NzEy","avatar_url":"https://avatars.githubusercontent.com/u/84712?v=4","gravatar_id":"","url":"https://api.github.com/users/dagar","html_url":"https://github.com/dagar","followers_url":"https://api.github.com/users/dagar/followers","following_url":"https://api.github.com/users/dagar/following{/other_user}","gists_url":"https://api.github.com/users/dagar/gists{/gist_id}","starred_url":"https://api.github.com/users/dagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dagar/subscriptions","organizations_url":"https://api.github.com/users/dagar/orgs","repos_url":"https://api.github.com/users/dagar/repos","events_url":"https://api.github.com/users/dagar/events{/privacy}","received_events_url":"https://api.github.com/users/dagar/received_events","type":"User","site_admin":false},"parents":[{"sha":"0dc8119c8940a361ec6a94efd33f89eba14d6d7c","url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/0dc8119c8940a361ec6a94efd33f89eba14d6d7c","html_url":"https://github.com/PX4/PX4-Autopilot/commit/0dc8119c8940a361ec6a94efd33f89eba14d6d7c"}],"stats":{"total":14,"additions":7,"deletions":7},"files":[{"sha":"c142a9a7520773c3e0396b441f0a0ab84c231983","filename":"msg/task_stack_info.msg","status":"modified","additions":1,"deletions":3,"changes":4,"blob_url":"https://github.com/PX4/PX4-Autopilot/blob/0e949a36ee104b8ace10eedaa1fcd83a00e3265a/msg%2Ftask_stack_info.msg","raw_url":"https://github.com/PX4/PX4-Autopilot/raw/0e949a36ee104b8ace10eedaa1fcd83a00e3265a/msg%2Ftask_stack_info.msg","contents_url":"https://api.github.com/repos/PX4/PX4-Autopilot/contents/msg%2Ftask_stack_info.msg?ref=0e949a36ee104b8ace10eedaa1fcd83a00e3265a","patch":"@@ -2,7 +2,5 @@\n \n uint64 timestamp\t\t# time since system start (microseconds)\n \n-uint8 MAX_REPORT_TASK_NAME_LEN = 16\n-\n uint16 stack_free\n-char[16] task_name\n+char[24] task_name"},{"sha":"7781ffc71f8413d504f27d3daed23c408ea280bf","filename":"src/modules/load_mon/load_mon.cpp","status":"modified","additions":6,"deletions":4,"changes":10,"blob_url":"https://github.com/PX4/PX4-Autopilot/blob/0e949a36ee104b8ace10eedaa1fcd83a00e3265a/src%2Fmodules%2Fload_mon%2Fload_mon.cpp","raw_url":"https://github.com/PX4/PX4-Autopilot/raw/0e949a36ee104b8ace10eedaa1fcd83a00e3265a/src%2Fmodules%2Fload_mon%2Fload_mon.cpp","contents_url":"https://api.github.com/repos/PX4/PX4-Autopilot/contents/src%2Fmodules%2Fload_mon%2Fload_mon.cpp?ref=0e949a36ee104b8ace10eedaa1fcd83a00e3265a","patch":"@@ -247,12 +247,14 @@ void LoadMon::_stack_usage()\n \n \t\ttask_stack_info_s task_stack_info = {};\n \n-\t\tif (system_load.tasks[task_index].valid && system_load.tasks[task_index].tcb->pid > 0) {\n+\t\tif (system_load.tasks[task_index].valid && (system_load.tasks[task_index].tcb->pid > 0)) {\n \n \t\t\tstack_free = up_check_tcbstack_remain(system_load.tasks[task_index].tcb);\n \n-\t\t\tstrncpy((char *)task_stack_info.task_name, system_load.tasks[task_index].tcb->name,\n-\t\t\t\ttask_stack_info_s::MAX_REPORT_TASK_NAME_LEN);\n+\t\t\tstatic_assert(sizeof(task_stack_info.task_name) == CONFIG_TASK_NAME_SIZE,\n+\t\t\t\t      \"task_stack_info.task_name must match NuttX CONFIG_TASK_NAME_SIZE\");\n+\t\t\tstrncpy((char *)task_stack_info.task_name, system_load.tasks[task_index].tcb->name, CONFIG_TASK_NAME_SIZE - 1);\n+\t\t\ttask_stack_info.task_name[CONFIG_TASK_NAME_SIZE - 1] = '\\0';\n \n #if CONFIG_NFILE_DESCRIPTORS > 0\n \t\t\tFAR struct task_group_s *group = system_load.tasks[task_index].tcb->group;\n@@ -269,7 +271,7 @@ void LoadMon::_stack_usage()\n \t\t\t\tfds_free = CONFIG_NFILE_DESCRIPTORS - tcb_num_used_fds;\n \t\t\t}\n \n-#endif\n+#endif // CONFIG_NFILE_DESCRIPTORS\n \n \t\t\tchecked_task = true;\n \t\t}"}]}