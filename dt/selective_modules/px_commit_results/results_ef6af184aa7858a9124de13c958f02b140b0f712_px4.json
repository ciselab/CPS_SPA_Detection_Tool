{"sha":"ef6af184aa7858a9124de13c958f02b140b0f712","node_id":"MDY6Q29tbWl0NTI5ODc5MDplZjZhZjE4NGFhNzg1OGE5MTI0ZGUxM2M5NThmMDJiMTQwYjBmNzEy","commit":{"author":{"name":"Lorenz Meier","email":"lm@inf.ethz.ch","date":"2014-06-01T13:35:26Z"},"committer":{"name":"Lorenz Meier","email":"lm@inf.ethz.ch","date":"2014-06-01T13:35:26Z"},"message":"sdlog2: Logging wind estimate at low rate","tree":{"sha":"b42749e6551c75ff210cc229c7602f32a949ecf9","url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/trees/b42749e6551c75ff210cc229c7602f32a949ecf9"},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/git/commits/ef6af184aa7858a9124de13c958f02b140b0f712","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/ef6af184aa7858a9124de13c958f02b140b0f712","html_url":"https://github.com/PX4/PX4-Autopilot/commit/ef6af184aa7858a9124de13c958f02b140b0f712","comments_url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/ef6af184aa7858a9124de13c958f02b140b0f712/comments","author":{"login":"LorenzMeier","id":1208119,"node_id":"MDQ6VXNlcjEyMDgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/1208119?v=4","gravatar_id":"","url":"https://api.github.com/users/LorenzMeier","html_url":"https://github.com/LorenzMeier","followers_url":"https://api.github.com/users/LorenzMeier/followers","following_url":"https://api.github.com/users/LorenzMeier/following{/other_user}","gists_url":"https://api.github.com/users/LorenzMeier/gists{/gist_id}","starred_url":"https://api.github.com/users/LorenzMeier/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LorenzMeier/subscriptions","organizations_url":"https://api.github.com/users/LorenzMeier/orgs","repos_url":"https://api.github.com/users/LorenzMeier/repos","events_url":"https://api.github.com/users/LorenzMeier/events{/privacy}","received_events_url":"https://api.github.com/users/LorenzMeier/received_events","type":"User","site_admin":false},"committer":{"login":"LorenzMeier","id":1208119,"node_id":"MDQ6VXNlcjEyMDgxMTk=","avatar_url":"https://avatars.githubusercontent.com/u/1208119?v=4","gravatar_id":"","url":"https://api.github.com/users/LorenzMeier","html_url":"https://github.com/LorenzMeier","followers_url":"https://api.github.com/users/LorenzMeier/followers","following_url":"https://api.github.com/users/LorenzMeier/following{/other_user}","gists_url":"https://api.github.com/users/LorenzMeier/gists{/gist_id}","starred_url":"https://api.github.com/users/LorenzMeier/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LorenzMeier/subscriptions","organizations_url":"https://api.github.com/users/LorenzMeier/orgs","repos_url":"https://api.github.com/users/LorenzMeier/repos","events_url":"https://api.github.com/users/LorenzMeier/events{/privacy}","received_events_url":"https://api.github.com/users/LorenzMeier/received_events","type":"User","site_admin":false},"parents":[{"sha":"50342f96613d6a6d428b8b65a572c93696bd720f","url":"https://api.github.com/repos/PX4/PX4-Autopilot/commits/50342f96613d6a6d428b8b65a572c93696bd720f","html_url":"https://github.com/PX4/PX4-Autopilot/commit/50342f96613d6a6d428b8b65a572c93696bd720f"}],"stats":{"total":27,"additions":27,"deletions":0},"files":[{"sha":"c19579f0f94e956ad4d6f9eb6181de589cca0089","filename":"src/modules/sdlog2/sdlog2.c","status":"modified","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/PX4/PX4-Autopilot/blob/ef6af184aa7858a9124de13c958f02b140b0f712/src%2Fmodules%2Fsdlog2%2Fsdlog2.c","raw_url":"https://github.com/PX4/PX4-Autopilot/raw/ef6af184aa7858a9124de13c958f02b140b0f712/src%2Fmodules%2Fsdlog2%2Fsdlog2.c","contents_url":"https://api.github.com/repos/PX4/PX4-Autopilot/contents/src%2Fmodules%2Fsdlog2%2Fsdlog2.c?ref=ef6af184aa7858a9124de13c958f02b140b0f712","patch":"@@ -87,6 +87,7 @@\n #include <uORB/topics/tecs_status.h>\n #include <uORB/topics/system_power.h>\n #include <uORB/topics/servorail_status.h>\n+#include <uORB/topics/wind_estimate.h>\n \n #include <systemlib/systemlib.h>\n #include <systemlib/param/param.h>\n@@ -943,6 +944,7 @@ int sdlog2_thread_main(int argc, char *argv[])\n \t\tstruct tecs_status_s tecs_status;\n \t\tstruct system_power_s system_power;\n \t\tstruct servorail_status_s servorail_status;\n+\t\tstruct wind_estimate_s wind_estimate;\n \t} buf;\n \n \tmemset(&buf, 0, sizeof(buf));\n@@ -982,6 +984,7 @@ int sdlog2_thread_main(int argc, char *argv[])\n \t\t\tstruct log_GS1A_s log_GS1A;\n \t\t\tstruct log_GS1B_s log_GS1B;\n \t\t\tstruct log_TECS_s log_TECS;\n+\t\t\tstruct log_WIND_s log_WIND;\n \t\t} body;\n \t} log_msg = {\n \t\tLOG_PACKET_HEADER_INIT(0)\n@@ -1016,6 +1019,7 @@ int sdlog2_thread_main(int argc, char *argv[])\n \t\tint tecs_status_sub;\n \t\tint system_power_sub;\n \t\tint servorail_status_sub;\n+\t\tint wind_sub;\n \t} subs;\n \n \tsubs.cmd_sub = orb_subscribe(ORB_ID(vehicle_command));\n@@ -1044,6 +1048,9 @@ int sdlog2_thread_main(int argc, char *argv[])\n \tsubs.tecs_status_sub = orb_subscribe(ORB_ID(tecs_status));\n \tsubs.system_power_sub = orb_subscribe(ORB_ID(system_power));\n \tsubs.servorail_status_sub = orb_subscribe(ORB_ID(servorail_status));\n+\tsubs.wind_sub = orb_subscribe(ORB_ID(wind_estimate));\n+\t/* we need to rate-limit wind, as we do not need the full update rate */\n+\torb_set_interval(subs.wind_sub, 90);\n \n \tthread_running = true;\n \n@@ -1512,6 +1519,16 @@ int sdlog2_thread_main(int argc, char *argv[])\n \t\t\tLOGBUFFER_WRITE_AND_COUNT(TECS);\n \t\t}\n \n+\t\t/* --- WIND ESTIMATE --- */\n+\t\tif (copy_if_updated(ORB_ID(wind_estimate), subs.wind_sub, &buf.wind_estimate)) {\n+\t\t\tlog_msg.msg_type = LOG_WIND_MSG;\n+\t\t\tlog_msg.body.log_WIND.x = buf.wind_estimate.windspeed_north;\n+\t\t\tlog_msg.body.log_WIND.y = buf.wind_estimate.windspeed_east;\n+\t\t\tlog_msg.body.log_WIND.cov_x = buf.wind_estimate.covariance_north;\n+\t\t\tlog_msg.body.log_WIND.cov_y = buf.wind_estimate.covariance_east;\n+\t\t\tLOGBUFFER_WRITE_AND_COUNT(WIND);\n+\t\t}\n+\n \t\t/* signal the other thread new data, but not yet unlock */\n \t\tif (logbuffer_count(&lb) > MIN_BYTES_TO_WRITE) {\n \t\t\t/* only request write if several packets can be written at once */"},{"sha":"a6eb7a5bd36dd5f6ba957e871402028a7db94818","filename":"src/modules/sdlog2/sdlog2_messages.h","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/PX4/PX4-Autopilot/blob/ef6af184aa7858a9124de13c958f02b140b0f712/src%2Fmodules%2Fsdlog2%2Fsdlog2_messages.h","raw_url":"https://github.com/PX4/PX4-Autopilot/raw/ef6af184aa7858a9124de13c958f02b140b0f712/src%2Fmodules%2Fsdlog2%2Fsdlog2_messages.h","contents_url":"https://api.github.com/repos/PX4/PX4-Autopilot/contents/src%2Fmodules%2Fsdlog2%2Fsdlog2_messages.h?ref=ef6af184aa7858a9124de13c958f02b140b0f712","patch":"@@ -366,6 +366,15 @@ struct log_TECS_s {\n \tuint8_t mode;\n };\n \n+/* --- WIND - WIND ESTIMATE --- */\n+#define LOG_WIND_MSG 31\n+struct log_WIND_s {\n+\tfloat x;\n+\tfloat y;\n+\tfloat cov_x;\n+\tfloat cov_y;\n+};\n+\n /********** SYSTEM MESSAGES, ID > 0x80 **********/\n \n /* --- TIME - TIME STAMP --- */\n@@ -422,6 +431,7 @@ static const struct log_format_s log_formats[] = {\n \tLOG_FORMAT(GS1A, \"BBBBBBBBBBBBBBBB\",\t\"s0,s1,s2,s3,s4,s5,s6,s7,s8,s9,s10,s11,s12,s13,s14,s15\"),\n \tLOG_FORMAT(GS1B, \"BBBBBBBBBBBBBBBB\",\t\"s0,s1,s2,s3,s4,s5,s6,s7,s8,s9,s10,s11,s12,s13,s14,s15\"),\n \tLOG_FORMAT(TECS, \"ffffffffffffB\",\t\"AltSP,Alt,FpaSP,Fpa,AsSP,As,AsDSP,AsD,TERSP,TER,EDRSP,EDR,Mod\"),\n+\tLOG_FORMAT(WIND, \"fff\",\t\"X,Y,Cov\"),\n \n \t/* system-level messages, ID >= 0x80 */\n \t/* FMT: don't write format of format message, it's useless */"}]}